<!DOCTYPE html>
<html>
  <script src="js-test.js"></script>
  <body>
    <script type="text/javascript">
      description("Test EME permission callbacks in WebView");
      window.jsTestIsAsync = true;

      // https://w3c.github.io/encrypted-media/#requestMediaKeySystemAccess
      // Tries multiple configuration per key system. The configurations are in
      // descending order of privileges such that a supported permission-requiring
      // configuration should be attempted before a configuration that does not
      // require permissions.

      // TODO(yolandyan) Look into whehther more key system need to be added
      var chromeKeySystem = "com.widevine.alpha"

      var tryKeySystem = function(keySystem) {
        console.log("keySystem is " + keySystem);
        navigator.requestMediaKeySystemAccess(
          keySystem,
          [
            { distinctiveIdentifier: "required",
              persistentState: "required",
              label: "'distinctiveIdentifier' and 'persistentState' required"
            },
            { distinctiveIdentifier: "required",
              label: "'distinctiveIdentifier' required"
            },
            { persistentState: "required",
              label: "'persistentState' required"
            },
            { label: "empty" }
          ]
        ).then(
          function (mediaKeySystemAccess) {
            console.log("eme success");
            finishJSTest();
          },
          function (error) {
            debug("onError: code" + error.code + ", message=" + error.message);
            finishJSTest();
          }
        );
      };

      tryKeySystem(chromeKeySystem);
    </script>
  </body>
</html>
